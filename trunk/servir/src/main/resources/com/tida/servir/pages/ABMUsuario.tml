<html t:type="layout" title="Editar Usuarios"
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
      xmlns:p="tapestry:parameter">

    <h2>Administración de Usuarios</h2>
    <h3>Busqueda de usuarios</h3>
    <div class="box">
        <t:form t:id="formulariobusqueda"  t:zone="tabla_usuario">
            <div style="display:block;">
                <t:errors/>
                <div id="filtrosnombres" class="f-wrap">
                    <div class="f-left">
                        <t:label for="bidentificacionBusqueda"/>
                        <input t:type="TextField" t:id="bidentificacionBusqueda" size="30"/>
                    </div>
                    <div class="f-left">
                        <t:label for="apellidosBusqueda"/>
                        <input t:type="TextField" t:id="apellidosBusqueda" size="30"/>
                    </div>
                    <div class="f-left">
                        <t:label for="nombresBusqueda"/>
                        <input t:type="TextField" t:id="nombresBusqueda" size="30"/>
                    </div>
                </div> <!-- filtrosnombres -->
            </div> <!-- busquedas -->
            <div id="bouttons" class="f-right">
                <input id="buscarsubmit" type="submit" value="Buscar" class="button f-right"/>
                    <!-- <input t:id = "borrarbusquedas" t:type="submit" value="Borrar" class="button"/> -->
            </div>
            <br class="clear" />
        </t:form>
    </div> <!-- Zona filtros -->
    <br />
    <t:zone t:id="tabla_usuario">    
        <t:if test="primeraVez">
                <t:grid inPlace="true" source="usuarios" rowsPerPage="10" t:add="organismo,accionesListaUsuario" pagerPosition="bottom" row="u" exclude= "id,md5Clave,clave,apellidopaterno,apellidomaterno,rolid,intentosFallidos,ultimoCambioClave,emaillaboral,trabajadorid" reorder="nrodocumento,nombres,apellidos,estado">
                    <t:parameter name="empty">
                        <div class="no-info">No existen usuarios con los criterios seleccionados.</div>
                    </t:parameter>
                
                    <p:organismoCell>
                        <t:if test="u.entidad">
                            ${u.entidad.denominacion}
                        </t:if>
                    </p:organismoCell>
                    <p:accionesListaUsuarioCell>
                        <t:eventLink t:event="editaUsuario" t:context="u" href="#" t:zone="tabla_usuario">
                            Editar
                        </t:eventLink>
                        | 
                        <a t:type="actionlink" t:id="reporteUsuario" t:context="u.id" href="#">Trazabilidad del Usuario</a>
                    </p:accionesListaUsuarioCell>
                </t:grid>
        </t:if>
    </t:zone>
  
    <br />
    <t:zone t:id="editarUsuarioZone">
        <t:if test="editaUsuario">
            <h3>Datos del Usuario</h3>
            <div class="box" id="box_u">
                <t:envelope t:id="envelope"/>
                <div id="form_usuario" class="abmform">
                    <t:form  t:id="formulariousuario" t:zone="editarUsuarioZone">
                        <t:errors/>
                        <div class="f-left">
                            <t:label for="apellidoPaterno" />
                            <input t:type="TextField" t:id="apellidoPaterno" t:value="usuariotrabajador.apellidopaterno" size="25" t:disabled="true"/>
                        </div>
                        <div class="f-left">
                            <t:label for="apellidoMaterno" />
                            <input t:type="TextField" t:id="apellidoMaterno" t:value="usuariotrabajador.apellidomaterno" size="25" t:disabled="true"/>
                        </div>
                        <div class="f-left">
                            <t:label for="nombres" />
                            <input t:type="TextField" t:id="nombres" t:value="usuariotrabajador.nombres" size="25" t:disabled="true"/>
                        </div>
                        <div class="f-left">
                            <t:label for="identificacion_usuario" />
                            <input t:type="TextField" t:id="identificacion_usuario" t:value="usuario.login" size="25" t:disabled="true"/>
                        </div>
                        <div class="f-left">
                            <t:label for="email" />
                            <input t:type="TextField" t:id="email" t:value="usuariotrabajador.emailLaboral" size="25" t:disabled="true"/>
                        </div>
                        <div class="f-left">
                            <t:label for="intentos_fallidos" />
                            <input t:type="TextField" t:id="intentos_fallidos" t:value="usuario.intentos_fallidos" t:disabled="true" size="1"/>
                        </div>
                        <div class="f-left">
                            <label>Blanquear los intentos fallidos</label>
                            <input t:type="Checkbox" t:value="blanquearIntentosFallidos" />
                        </div>
                        <div class="f-left">
                            <label>Ultimo cambio de clave: 
                                <strong>${usuario.ultimo_cambio_clave}</strong>
                            </label>
                        </div>
                        <br style="clear: both;" />
                        <div class="f-left">
                            <t:label for="estadousuario" />
                            <t:select t:id="estadousuario" model = "estadoUsuario" encoder="estadoUsuario" t:value="lkEstadoUsuario"  t:validate="required"/>
                        </div>
                        <div class="f-left">
                            <label>Reiniciar contraseña</label>
                            <input t:type="Checkbox" t:value="reinitialisarpassword" />
                        </div>
                        <div class="f-left">
                            <t:label for="rolUsuario"/>
                            <t:select t:id="rolUsuario" model="rolUsuario" encoder="rolUsuario" t:validate="required" t:value="rscrol"/>
                        </div>
                        <br class="clear"/>
                        <div id="bouttons" class="f-right">
                            <input t:type="Submit" t:id="save" value="Grabar" t:mixins="confirm" t:message="Desea ejecutar esta acción?" class="button f-right"/>
                            <input t:type="Submit" t:id="cancel" value="Cancelar" t:mixins="confirm" t:message="Desea ejecutar esta acción?" class="button f-right"/>
                        </div>
                        <br class="clear" />
                    </t:form>
                </div>
            </div>
            <br />
            <h3>Perfiles asignados al usuario</h3>
            <t:grid t:source="allPerfiles" t:add="Acciones" pagerPosition="bottom" row="rowPerfil" exclude="rownum,usuarioId, perfilId" >
                <p:accionesCell>
                    <t:actionlink t:id="eliminaPerfil" t:mixins="confirm" t:message="Desea ejecutar esta acción?" t:context="rowPerfil" href="#" t:zone="editarUsuarioZone">Eliminar</t:actionlink>
                </p:accionesCell>
            </t:grid>
        </t:if>
    </t:zone>
    <br />
    <t:zone t:id="perfilZone">
        <t:if test = "botonPerfil">
            <div id="bouttons" class="f-right">
                <t:eventLink t:event="newPerfil" href="#" t:zone="perfilZone" class="button f-right">
                    Agregar Perfil
                </t:eventLink>
            </div>
            <br class="clear"/>
        </t:if>
        <t:if test = "newPerfil">
            <h3>Asignar Perfil al Usuario</h3>
            <div id="box-cargos" class="box">
                <t:form t:id="perfilInputForm" t:zone="perfilZone">
                    <div class ="f-wrap">
                        <div class="f-left">
                            <fieldset>
                                <legend>Seleccione Opción:</legend>
                                <label>
                                    <t:select t:id="selectPerfiles" model="selectPerfiles" encoder="selectPerfiles" t:value="perfil" t:validate="required" style="width: 400px;" />
                                </label>
                            </fieldset>
                        </div>
                    </div>
                    <div id="bouttons" class="f-right">
                        <input t:type="Submit" t:id="savePerfil" value="Grabar" t:mixins="confirm" t:message="Desea ejecutar esta acción?" class="button f-right"/>
                        <input t:type="Submit" t:id="cancelPerfil" value="Cancelar" t:mixins="confirm" t:message="Desea ejecutar esta acción?" class="button f-right"/>
                    </div>
                    <br class="clear"/>
                </t:form>
            </div>
        </t:if>
    </t:zone>
</html>